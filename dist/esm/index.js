var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},defaultValues={excludePath:[],dev:!1,hash:!1,domain:null,params:{},proxyServer:"https://api.vantevo.io/event",proxyServerEcommerce:"https://api.vantevo.io/event-ecommerce"};function VantevoAnalytics(e){var t=defaultValues,l=(t=e?__assign(__assign({},defaultValues),e):t).dev,u=t.hash,d=t.excludePath,p=t.params,w=t.domain,f=t.proxyServer,r=t.proxyServerEcommerce,h="Ignores hit on localhost.",m="data-vantevo-";function v(e){return/^localhost(.*)$|^127(\.[0-9]{1,3}){3}$/i.test(e)}function g(e){for(var t={},n=0;n<e.attributes.length;n++){var o=e.attributes[n];o.nodeName&&0==o.nodeName.toLowerCase().indexOf(m)&&(t[o.nodeName.toString().replace(m,"")]=o.textContent||"1")}return t}function y(){return!!(window.__phantomas||window._phantom||window.__nightmare||window.navigator.webdriver||window.Cypress)}var n,_=function(e,t,n){if(void 0===t&&(t={}),!y()){var o="file:"===window.location.protocol;if(w&&(v(w)||o))return console.warn(h);if(!w&&!l&&(v(window.location.hostname)||o))return console.warn(h);if((!e||"pageview"==e)&&0<d.length)for(var i=window.location.pathname.split("?")[0],r=0;r<d.length;r++)if(new RegExp("^"+d[r].trim().replace(/\*\*/g,".*").replace(/([^\.])\*/g,"$1[^\\s/]*")+"/?$").test(i))return!!l&&console.warn("Exclude page");var a,o={},s="",c=(w&&(o=__assign(__assign({},p),{domain:w})),u&&(o=__assign(__assign({},o),{hash:!0})),e&&"pageview"==e&&t&&t.path&&(o=__assign(__assign({},o),{path:t.path})),document.title),o=(e&&"pageview"!=e||!t||!t.title||(c=t.title),a=o,o=Object.fromEntries(Object.entries(a).filter(function(e){return e[0],null!=e[1]})),s=Object.keys(o).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(a[e])}).join("&"),{ts:(new Date).getTime(),url:window.location.href,t:c,ref:document.referrer,w:screen.width,h:screen.height,params:s,e_n:e||"pageview",e_m:t||{}});if(l)return console.log("SUCCESS HIT!",JSON.stringify(o)),n&&n();c=new XMLHttpRequest;c.open("POST",f),c.setRequestHeader("Content-Type","text/plain"),c.send(JSON.stringify(o)),c.onreadystatechange=function(e){4==e.readyState&&n&&n()}}};function o(){!u&&n===window.location.pathname||(n=window.location.pathname,_("pageview",{},null))}function i(e){for(var t,n=e.target,o="auxclick"==e.type&&2==e.which,i="click"==e.type;n&&(void 0===n.tagName||"a"!=n.tagName.toLowerCase()||!n.href);)n=n.parentNode;n&&n.href&&n.host&&n.host!==window.location.host&&(t=n.hasAttribute(m+"exclude-outbound-link"),!o&&!i||t||((o=g(n)).url=n.href,_("Outbound Link",o,null)),n.target&&!n.target.match(/^_(self|parent|top)$/i)||e.ctrlKey||e.metaKey||e.shiftKey||!i||(setTimeout(function(){window.location.href=n.href},150),e.preventDefault()))}return{vantevo:_,trackEcommerce:function(e,t,n){if(!y()){if(w&&v(w))return console.warn(h);if(!w&&!l&&v(window.location.hostname))return console.warn(h);if(!e)return console.warn("Event name is required.");if(!t.items||!Array.isArray(t.items)||0==t.items.length)return console.warn("Items is required.");var o=__assign({},t),e=(["items","total","coupon_value","payment_type","shipping_method"].forEach(function(e){return delete o[e]}),__assign({ts:(new Date).getTime(),url:location.href,t:document.title,ref:document.referrer,w:window.innerWidth,h:window.innerHeight,params:p,event:e,items:t.items,total:t.total||0,coupon:t.coupon||"",payment_type:t.payment_type||"",shipping_method:t.shipping_method||""},o));if(l)return console.log("HIT ECOMMERCE:",JSON.stringify(e)),n&&n();var t=r,i=new XMLHttpRequest;i.open("POST",t,!0),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e)),i.onreadystatechange=function(){if(4==i.readyState)return n&&n()}}},enableTracker:function(){var e=window.history.pushState;return e&&(window.history.pushState=function(){e.apply(this,arguments),setTimeout(o,0)},window.addEventListener("popstate",function(){setTimeout(o,0)})),document.body?o():window.addEventListener("DOMContentLoaded",o),function(){e&&(window.history.pushState=e,window.removeEventListener("popstate",o))}},enableTrackFiles:function(s,c){function e(e){for(var t=e.target,n="auxclick"==e.type&&2==e.which,o="click"==e.type;t&&(void 0===t.tagName||"a"!=t.tagName.toLowerCase()||!t.href);)t=t.parentNode;var i,r,a=!1;t&&t.href&&(i=[],t.hasAttribute(m+"exclude-track-file")||(s&&"string"==typeof s&&(i=s.replace(/\s/g,"").split(",")),(n||o)&&0<i.length&&(r=t.href.split(".").pop(),i.some(function(e){return e==r})&&(a=!0,(n=g(t)).url=t.href,(c||n["save-extension"])&&(n.extension=r),_("File Download",n,null))))),!a||t.target&&!t.target.match(/^_(self|parent|top)$/i)||e.ctrlKey||e.metaKey||e.shiftKey||!o||(setTimeout(function(){window.location.href=t.href},150),e.preventDefault())}return void 0===s&&(s=""),void 0===c&&(c=!1),window.addEventListener("click",e),window.addEventListener("auxclick",e),function(){window.removeEventListener("click",e),window.removeEventListener("auxclick",e)}},enableOutboundLinks:function(){return window.addEventListener("click",i),window.addEventListener("auxclick",i),function(){window.removeEventListener("click",i),window.removeEventListener("auxclick",i)}}}}export{VantevoAnalytics as default};
//# sourceMappingURL=index.js.map
